<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <script src="static/echarts.js"></script>
    <script src="static/jquery.js"></script>
</head>
<body>
<div style="height:100vh;margin:auto 0">
    <div id="main" style="width:100%;height:100%;margin:auto auto"></div>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById("main"));
        myChart.showLoading(); // 加载等待
        var json_data = {{ json_data | tojson }};
        option = {
            // 图的标题
            title: {
                text: json_data.title
            },
            // 提示框的配置
            tooltip: {
                formatter: function (x) {
                    return x.data.des;
                }
            },
            // 工具箱
            toolbox: {
                // 显示工具箱
                show: true,
                feature: {
                    mark: {
                        show: true
                    },
                    // 还原
                    restore: {
                        show: true
                    },
                    // 保存为图片
                    saveAsImage: {
                        show: true
                    }
                }
            },
            legend: [{
                // selectedMode: "single",
                data: json_data.categories.map(function (a) {
                    return a.name;
                })
            }],
            emphasis: {
                itemStyle: {
                    normal: {
                        // 高亮状态下的边框样式
                        borderColor: '#000', // 高亮状态下边框颜色，这里使用黑色
                        borderWidth: 2, // 高亮状态下边框宽度增加，以突出显示
                        opacity: 1 // 高亮状态下不透明度
                    }
                }
            },
            series: [{
                type: "graph", // 类型:关系图
                layout: "force", //图的布局，类型为力导图
                //symbolSize: 40, // 调整节点的大小
                roam: true, // 是否开启鼠标缩放和平移漫游。默认不开启。如果只想要开启缩放或者平移,可以设置成 "scale" 或者 "move"。设置成 true 为都开启
                // edgeSymbol: ["circle", "arrow"],
                //edgeSymbolSize: [2, 10],
                //edgeLabel: {
                //    normal: {
                //        textStyle: {
                //            fontSize: 20
                //        }
                //    }
                //},
                force: {
                    repulsion: 2500,
                    edgeLength: [10, 50]
                },
                draggable: true,
                lineStyle: {
                    normal: {
                        width: 2,
                        color: "#4b565b",
                    }
                },
                edgeLabel: {
                    normal: {
                        show: true,
                        formatter: function (x) {
                            return x.data.name;
                        }
                    }
                },
                label: {
                    normal: {
                        show: true,
                        textStyle: {}
                    }
                },
                emphasis: {
                    disable: true,
                    itemStyle: {
                        borderColor: '#000',
                        borderWidth: 2,
                        borderType: "solid"
                    }
                },
                // 数据
                data: json_data.data,
                links: json_data.links,
                categories: json_data.categories,
            }]
        };
        myChart.hideLoading();// 隐藏加载等待
        myChart.setOption(option);

        var highlightNode; // 记录旧的高亮节点
        myChart.on("click", function (event) {
            // 将之前高亮的节点释放掉
            if (typeof highlightNode != 'undefined') {
                myChart.dispatchAction({
                    type: 'downplay',
                    seriesIndex: 0,
                    name: highlightNode
                });
            }
            console.log(event.name);
            highlightNode = event.name
            // 高亮新节点
            myChart.dispatchAction({
                type: "highlight",
                seriesIndex: 0,
                name: highlightNode
            });
        });
        myChart.getZr().on('click', function (event) {
            // 没有 target 意味着鼠标/指针不在任何一个图形元素上，它是从“空白处”触发的。
            if (!event.target) {
                // 点击在了空白处，解除高亮
                if (typeof highlightNode != 'undefined') {
                    myChart.dispatchAction({
                        type: 'downplay',
                        seriesIndex: 0,
                        name: highlightNode
                    });
                }
            }
        });
    </script>
</div>
</body>
</html>